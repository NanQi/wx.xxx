!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t["wx-async"]=e()}(this,function(){"use strict";function t(t,e){return e={exports:{}},t(e,e.exports),e.exports}function e(t,e,n,r){for(var u=t.length,o=n+(r?1:-1);r?o--:++o<u;)if(e(t[o],o,t))return o;return-1}function n(t){return t!==t}function r(t,e,n){for(var r=n-1,u=t.length;++r<u;)if(t[r]===e)return r;return-1}function u(t,e,n){return e===e?s(t,e,n):i(t,f,n)}function o(){}function a(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var i=e,f=n,s=r,l=u,c=Array.isArray,d=c,p=o,h=t(function(t,e){function n(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n,t.exports=e.default}),v=t(function(t,e){function n(t,e){e|=0;for(var n=Math.max(t.length-e,0),r=Array(n),u=0;u<n;u++)r[u]=t[e+u];return r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n,t.exports=e.default}),y=t(function(t,e){function n(t){setTimeout(t,0)}function r(t){return function(e){var n=(0,o.default)(arguments,1);t(function(){e.apply(null,n)})}}Object.defineProperty(e,"__esModule",{value:!0}),e.hasNextTick=e.hasSetImmediate=void 0,e.fallback=n,e.wrap=r;var u,o=function(t){return t&&t.__esModule?t:{default:t}}(v),a=e.hasSetImmediate="function"==typeof setImmediate&&setImmediate,i=e.hasNextTick="object"==typeof process&&"function"==typeof process.nextTick;u=a?setImmediate:i?process.nextTick:n,e.default=r(u)}),_=t(function(t,e){function n(){this.head=this.tail=null,this.length=0}function r(t,e){t.length=1,t.head=t.tail=e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n,n.prototype.removeLink=function(t){return t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev,t.prev=t.next=null,this.length-=1,t},n.prototype.empty=function(){for(;this.head;)this.shift();return this},n.prototype.insertAfter=function(t,e){e.prev=t,e.next=t.next,t.next?t.next.prev=e:this.tail=e,t.next=e,this.length+=1},n.prototype.insertBefore=function(t,e){e.prev=t.prev,e.next=t,t.prev?t.prev.next=e:this.head=e,t.prev=e,this.length+=1},n.prototype.unshift=function(t){this.head?this.insertBefore(this.head,t):r(this,t)},n.prototype.push=function(t){this.tail?this.insertAfter(this.tail,t):r(this,t)},n.prototype.shift=function(){return this.head&&this.removeLink(this.head)},n.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)},n.prototype.toArray=function(){for(var t=Array(this.length),e=this.head,n=0;n<this.length;n++)t[n]=e.data,e=e.next;return t},n.prototype.remove=function(t){for(var e=this.head;e;){var n=e.next;t(e)&&this.removeLink(e),e=n}return this},t.exports=e.default}),m=a,x=t(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){var e=(0,n.default)(arguments),r=e.pop();t.call(this,e,r)}};var n=function(t){return t&&t.__esModule?t:{default:t}}(v);t.exports=e.default}),k=t(function(t,e){function n(t){return t&&t.__esModule?t:{default:t}}function r(t){return(0,i.default)(function(e,n){var r;try{r=t.apply(this,e)}catch(t){return n(t)}(0,a.default)(r)&&"function"==typeof r.then?r.then(function(t){u(n,null,t)},function(t){u(n,t.message?t:new Error(t))}):n(null,r)})}function u(t,e,n){try{t(e,n)}catch(t){(0,f.default)(o,t)}}function o(t){throw t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var a=n(m),i=n(x),f=n(y);t.exports=e.default}),b=t(function(t,e){function n(t){return o&&"AsyncFunction"===t[Symbol.toStringTag]}function r(t){return n(t)?(0,u.default)(t):t}Object.defineProperty(e,"__esModule",{value:!0}),e.isAsync=void 0;var u=function(t){return t&&t.__esModule?t:{default:t}}(k),o="function"==typeof Symbol;e.default=r,e.isAsync=n}),g=t(function(t,e){function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e,n){function r(t,e,n){if(null!=n&&"function"!=typeof n)throw new Error("task callback must be a function");if(y.started=!0,(0,o.default)(t)||(t=[t]),0===t.length&&y.idle())return(0,f.default)(function(){y.drain()});for(var r=0,u=t.length;r<u;r++){var i={data:t[r],callback:n||a.default};e?y._tasks.unshift(i):y._tasks.push(i)}(0,f.default)(y.process)}function l(t){return function(e){p-=1;for(var n=0,r=t.length;n<r;n++){var o=t[n],a=(0,u.default)(h,o,0);a>=0&&h.splice(a,1),o.callback.apply(o,arguments),null!=e&&y.error(e,o.data)}p<=y.concurrency-y.buffer&&y.unsaturated(),y.idle()&&y.drain(),y.process()}}if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var d=(0,c.default)(t),p=0,h=[],v=!1,y={_tasks:new s.default,concurrency:e,payload:n,saturated:a.default,unsaturated:a.default,buffer:e/4,empty:a.default,drain:a.default,error:a.default,started:!1,paused:!1,push:function(t,e){r(t,!1,e)},kill:function(){y.drain=a.default,y._tasks.empty()},unshift:function(t,e){r(t,!0,e)},remove:function(t){y._tasks.remove(t)},process:function(){if(!v){for(v=!0;!y.paused&&p<y.concurrency&&y._tasks.length;){var t=[],e=[],n=y._tasks.length;y.payload&&(n=Math.min(n,y.payload));for(var r=0;r<n;r++){var u=y._tasks.shift();t.push(u),h.push(u),e.push(u.data)}p+=1,0===y._tasks.length&&y.empty(),p===y.concurrency&&y.saturated();var o=(0,i.default)(l(t));d(e,o)}v=!1}},length:function(){return y._tasks.length},running:function(){return p},workersList:function(){return h},idle:function(){return y._tasks.length+p===0},pause:function(){y.paused=!0},resume:function(){!1!==y.paused&&(y.paused=!1,(0,f.default)(y.process))}};return y}Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var u=n(l),o=n(d),a=n(p),i=n(h),f=n(y),s=n(_),c=n(b);t.exports=e.default}),M=t(function(t,e){function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){var n=(0,u.default)(t);return(0,r.default)(function(t,e){n(t[0],e)},e,1)};var r=n(g),u=n(b);t.exports=e.default});return function(t){return t&&t.__esModule?t.default:t}(M)});
